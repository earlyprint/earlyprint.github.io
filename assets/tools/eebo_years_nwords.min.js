
//filename='../theme/js/eebo_years_nwords.csv'
filename='js/eebo_years_nwords.csv'


var width=1000;var height=600;var yearData;var medianData;var startYear=1473;var endYear=1700;var minWords=1;var maxWords=8000000;var radius;var padding=50;var xScale;var yScale;var svg;var dataSubset;$(document).ready(function(){$("#year-range").slider({range:true,min:startYear,max:endYear,values:[startYear,endYear],slide:function(event,ui){startYear=ui.values[0];endYear=ui.values[1];initGraph();updateGraph();}});});d3.csv(filename,function(d){data=d;initGraph();buildGraph();});function initGraph(){radius=(width-padding*2)/((endYear-startYear)*2);if(radius>3)radius=3;xScale=d3.scale.linear().domain([startYear,endYear]).range([padding,width-padding]);xAxis=d3.svg.axis().scale(xScale).orient('bottom').tickFormat(function(d){return d});yScale=d3.scale.log().domain([minWords,maxWords]).clamp(true).range([height-padding,padding]);yAxis=d3.svg.axis().scale(yScale).orient('left').ticks(10,function(d){return d});}
function buildGraph(){svg=d3.select('#scatterplot').append('svg').attr({width:width,height:height});var yearData=new Array(endYear-startYear);for(y=0;y<=endYear-startYear+1;y++){yearData[y]=[];}
for(c=0;c<data.length;c++){yearData[+data[c]['year']-startYear].push(+data[c]['nwords']);}
medianData=[];for(y=startYear;y<=endYear;y++){medianData.push({'year':y,'nwords':median(yearData[y-startYear])});}
var dots=svg.selectAll('circle').data(data).enter().append('circle').attr({cx:function(d){return xScale(+d['year'])},cy:function(d){return yScale(+d['nwords'])},r:radius-.5,'fill-opacity':.1,fill:'black'});var line=d3.svg.line().interpolate('basis').x(function(d){return xScale(+d['year']);}).y(function(d){return yScale(+d['nwords']);});svg.append("svg:path").attr("d",line(medianData)).attr({stroke:'blue','stroke-width':5,fill:'none','stroke-opacity':.5});svg.append('g').attr('class','xAxis').attr('transform','translate('+radius+','+(height-padding+2)+')').call(xAxis);svg.append('g').attr('class','yAxis').attr('transform','translate('+(padding-2)+',0)').call(yAxis);svg.selectAll('.xAxis, .yAxis').style({'font-family':'sans-serif','font-size':'10pt',fill:'none',stroke:'black'})}
function updateGraph(){dataSubset=[]
for(c=0;c<data.length;c++){if(+data[c]['year']>=startYear&&+data[c]['year']<=endYear){dataSubset.push(data[c]);}}
medianSubset=[]
for(c=0;c<medianData.length;c++){if(+medianData[c]['year']>=startYear&&+medianData[c]['year']<=endYear){medianSubset.push(medianData[c]);}}
svg.selectAll('path').remove();svg.selectAll('circle').remove();dots=svg.selectAll('circle').data(dataSubset).enter().append('circle').attr({cx:function(d){return xScale(+d['year'])+radius},cy:function(d){return yScale(+d['nwords'])},r:radius-.5,'fill-opacity':.1,fill:'black'});var line=d3.svg.line().interpolate('basis').x(function(d){return xScale(+d['year']);}).y(function(d){return yScale(+d['nwords']);});svg.append("svg:path").attr("d",line(medianSubset)).attr({stroke:'blue','stroke-width':5,fill:'none','stroke-opacity':.5});t=svg.transition().duration(5000);t.select('g.xAxis').attr('transform','translate('+radius+','+(height-padding+2)+')').call(xAxis);t.select('g.yAxis').call(yAxis);};function median(d){med=d.sort(function(a,b){return a-b})[Math.floor(d.length/2)];if(med==undefined)med=5000;return med;}
